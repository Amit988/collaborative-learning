{% extends "accounts/base.html" %}
{% load crispy_forms_tags %}
{% load static %}
{% load humanize %}
{% block title %}
Stories
{% endblock %}

{% block script %}

  <link rel="stylesheet" href="{% static 'accounts/css/stories.css' %}">

  <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-bs4.min.css" rel="stylesheet">
  
  <script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-bs4.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
  <!--<link rel="stylesheet" href="{% static 'accounts/css/style.css' %}">-->
  <link href='https://css.gg/bulb.css' rel='stylesheet'>
  <link rel="stylesheet" href="{% static 'accounts/css/style.css' %}">
  <script type='text/javascript' src='https://platform-api.sharethis.com/js/sharethis.js#property=613337eb495f05001236fe40&product=inline-share-buttons' async='async'></script>

    
{% endblock %}
{% block main %}
  
{% for msg in messages %}
   
    <p class="text-success text-center" id = "msg-container">{{msg}}</p>

                
{% endfor %}


      <section class="cta-section theme-bg-light py-5 text-start">
        <div class="container text-center single-col-max-width">
          <h2 class="heading"><a href="{% url 'stories' %}" class="text-dark text-decoration-none">cosb - Stories</a></h2>


          
          <!-- Select Menu for Voice -->
          <div class ="mt-5">
            <!--
            {% if audio %}
              {% for i in audio %}
              <audio src="{{i.audio.url}}" controls></audio>
              {% endfor %}
            {% endif %}-->
            <select id="voices" class="form-select bg-secondary text-light"></select>

          </div>
          

          <!-- Range Slliders for Volume, Rate & Pitch -->
          <!--<div class="d-flex mt-4 text-light">
            <div>
              <p class="lead">Volume</p>
              <input type="range" min="0" max="1" value="1" step="0.1" id="volume" />
              <span id="volume-label" class="ms-2">1</span>
            </div>
            <div class="mx-5">
              <p class="lead">Rate</p>
              <input type="range" min="0.1" max="10" value="1" id="rate" step="0.1" />
              <span id="rate-label" class="ms-2">1</span>
            </div>
            <div>
              <p class="lead">Pitch</p>
              <input type="range" min="0" max="2" value="1" step="0.1" id="pitch" />
              <span id="pitch-label" class="ms-2">1</span>
            </div>
          </div>-->

          <!-- Text Area  for the User to Type -->
          <input type="hidden" id = "pod" value="{{story.content}}">

          <!-- Control Buttons -->
          <div class="mb-5">
            <button id="start" class="btn btn-success mt-5 me-3">Start</button>
            <button id="pause" class="btn btn-warning mt-5 me-3">Pause</button>
            <button id="resume" class="btn btn-info mt-5 me-3">Resume</button>
            <button id="cancel" class="btn btn-danger mt-5 me-3">Cancel</button>
          </div>



        </div>
      </section>


    
    <section class="blog-list px-3 py-5 p-md-5">
      <div class="container single-col-max-width">

        <div class="item mb-5">
          <div class="row g-3 g-xl-0">


            <div class="col">
              <h3 class="title mb-1"><a class="text-link" href="">{{story.title}}</a></h3>

              
              <div class="meta mb-1"><span class="date">Published {{story.created_at|naturaltime}} by {{story.user.username}} in {{story.club.name}}</span><span class="comment"><a class="text-link" href="{% url 'view-story' story.id %}">{{story.views}} views</a></span></div>


              {% if story.user == request.user %}

                <div class="mb-3">

                  <a href = "{% url 'update-story' story.id  %} " class="m-1" style="text-decoration: none;">update</a>

                  <a class="text-decoration-none" type="button" data-toggle="collapse" data-target="#deleteBox{{story.id}}" aria-expanded="false" aria-controls="deleteBox{{story.id}}">
                  delete
                  </a>

                  <div class="collapse" id="deleteBox{{story.id}}">
                      <div class="card card-body my-2">

                          <h5 class="card-title text-danger">Are you sure?</h5>
                          <div class="text-start">

                            <a href = "{% url 'delete-story' story.id  %} " class="m-1 filled-button text-decoration-none" >Yup!</a>
                            
                          </div>
                          
                          
                      </div>
                  </div>
                  
                </div>


              {% endif %}

              <div class="intro mt-5" style="font-size: 24px;">{{story.content|safe}}</div>
              <!--<a class="text-link" href="">Read more &rarr;</a>-->
            </div><!--//col-->
          </div><!--//row-->
        </div><!--//item-->


      </div>
    </section>




<!--<script>
  $('#summernote').summernote({
    placeholder: 'Start writing...',
    tabsize: 2,
    height: 100,


  });


</script>-->


    <!-- begin wwww.htmlcommentbox.com -->
    <div class="container mt-3">

      <div class="row mb-5">

        <h4 class="display-5 fw-bold lh-1 mb-5 mt-5 text-center">How was this story?</h4>
        <div class="sharethis-inline-reaction-buttons"></div>
        
      </div>


      <div id="HCB_comment_box">loading comments...</div>
      
    </div>
     
    <link rel="stylesheet" type="text/css" href="https://www.htmlcommentbox.com/static/skins/bootstrap/twitter-bootstrap.css?v=0" />
    <script type="text/javascript" id="hcb"> /*<!--*/ if(!window.hcb_user){hcb_user={};} (function(){var s=document.createElement("script"), l=hcb_user.PAGE || (""+window.location).replace(/'/g,"%27"), h="https://www.htmlcommentbox.com";s.setAttribute("type","text/javascript");s.setAttribute("src", h+"/jread?page="+encodeURIComponent(l).replace("+","%2B")+"&mod=%241%24wq1rdBcg%24smQFpSrElVLoyPCVmkxue%2F"+"&opts=16798&num=10&ts=1637649470319");if (typeof s!="undefined") document.getElementsByTagName("head")[0].appendChild(s);})(); /*-->*/ </script>
    <!-- end www.htmlcommentbox.com -->


{% endblock %}

{% block ajaxbox %}

    <script>

        const ele = document.getElementById("msg-container")
        setTimeout(function(){

            ele.style.display = "none";
            },
         3000);


         // Initialize new SpeechSynthesisUtterance object
        let speech = new SpeechSynthesisUtterance();

        // Set Speech Language
        speech.lang = "en";

        let voices = []; // global array of available voices

        window.speechSynthesis.onvoiceschanged = () => {
          // Get List of Voices
          voices = window.speechSynthesis.getVoices();

          // Initially set the First Voice in the Array.
          speech.voice = voices[0];

          // Set the Voice Select List. (Set the Index as the value, which we'll use later when the user updates the Voice using the Select Menu.)
          let voiceSelect = document.querySelector("#voices");
          voices.forEach((voice, i) => (voiceSelect.options[i] = new Option(voice.name, i)));
        };

        /*document.querySelector("#rate").addEventListener("input", () => {
          // Get rate Value from the input
          const rate = document.querySelector("#rate").value;

          // Set rate property of the SpeechSynthesisUtterance instance
          speech.rate = rate;

          // Update the rate label
          document.querySelector("#rate-label").innerHTML = rate;
        });

        document.querySelector("#volume").addEventListener("input", () => {
          // Get volume Value from the input
          const volume = document.querySelector("#volume").value;

          // Set volume property of the SpeechSynthesisUtterance instance
          speech.volume = volume;

          // Update the volume label
          document.querySelector("#volume-label").innerHTML = volume;
        });

        document.querySelector("#pitch").addEventListener("input", () => {
          // Get pitch Value from the input
          const pitch = document.querySelector("#pitch").value;

          // Set pitch property of the SpeechSynthesisUtterance instance
          speech.pitch = pitch;

          // Update the pitch label
          document.querySelector("#pitch-label").innerHTML = pitch;
        });*/

        document.querySelector("#voices").addEventListener("change", () => {
          // On Voice change, use the value of the select menu (which is the index of the voice in the global voice array)
          speech.voice = voices[document.querySelector("#voices").value];
        });

        document.querySelector("#start").addEventListener("click", () => {
          // Set the text property with the value of the textarea

          if ('speechSynthesis' in window) {


            words = document.getElementById("pod");
            console.log(words.value);
            speech.text = words.value;

            // Start Speaking
            window.speechSynthesis.speak(speech);
          
          }else{
            // Speech Synthesis Not Supported ðŸ˜£
            alert("Sorry, your browser doesn't support text to speech!");
          }

        });

        document.querySelector("#pause").addEventListener("click", () => {
          // Pause the speechSynthesis instance
          window.speechSynthesis.pause();
        });

        document.querySelector("#resume").addEventListener("click", () => {
          // Resume the paused speechSynthesis instance
          window.speechSynthesis.resume();
        });

        document.querySelector("#cancel").addEventListener("click", () => {
          // Cancel the speechSynthesis instance
          window.speechSynthesis.cancel();
        });

    </script>
{% endblock %}